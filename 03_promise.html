<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>3. Promise</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        .container { max-width: 600px; margin: auto; padding: 20px; border: 1px solid lightgray; border-radius: 8px; }
        button { padding: 10px 15px; font-size: 16px; cursor: pointer; margin: 5px; }
        #log { margin-top: 20px; padding: 10px; border: 1px solid black; background-color: ghostwhite; min-height: 150px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>3. Promiseë¡œ ì½œë°± ì§€ì˜¥ íƒˆì¶œí•˜ê¸°</h1>
        <p>Promiseì˜ .then() ì²´ì´ë‹ì„ í†µí•´ ì½”ë“œê°€ ì–´ë–»ê²Œ ê°œì„ ë˜ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.</p>
        <button id="success-btn">ì„±ê³µ ì‹œë‚˜ë¦¬ì˜¤</button>
        <button id="fail-btn">ì‹¤íŒ¨ ì‹œë‚˜ë¦¬ì˜¤</button>
        <div id="log"></div>
    </div>

    <script>
        const successBtn = document.getElementById('success-btn');
        const failBtn = document.getElementById('fail-btn');
        const logDiv = document.getElementById('log');

        const log = (message, isError = false) => {
            logDiv.innerHTML += `<div style="color: ${isError ? 'red' : 'black'};">${message}</div>`;
        };

        /*
        ==================================================================================
        ğŸ¯ Promiseë€?
        ==================================================================================
        - ë¹„ë™ê¸° ì‘ì—…ì˜ ìµœì¢… ì„±ê³µ ë˜ëŠ” ì‹¤íŒ¨ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ê°ì²´ì…ë‹ˆë‹¤.
        - ì„±ê³µì€ resolve, ì‹¤íŒ¨ëŠ” reject í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ì—¬ ê²°ê³¼ë¥¼ ì „ë‹¬í•©ë‹ˆë‹¤.
        - .then(onFulfilled, onRejected): ì‘ì—… ì„±ê³µ/ì‹¤íŒ¨ ì‹œ ì‹¤í–‰ë  í•¨ìˆ˜ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤.
        - .catch(onRejected): ì‘ì—… ì‹¤íŒ¨ ì‹œ ì‹¤í–‰ë  í•¨ìˆ˜ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤. .then(null, onRejected)ê³¼ ê°™ìŠµë‹ˆë‹¤.
        - .finally(onFinally): ì„±ê³µ/ì‹¤íŒ¨ ì—¬ë¶€ì™€ ìƒê´€ì—†ì´ ë§ˆì§€ë§‰ì— í•­ìƒ ì‹¤í–‰ë©ë‹ˆë‹¤.
        */

        // Promiseë¥¼ ë°˜í™˜í•˜ëŠ” ë¹„ë™ê¸° ì‘ì—… í•¨ìˆ˜
        function asyncTask(taskName, duration, shouldSucceed) {
            log(`â³ '${taskName}' ì‘ì—… ì‹œì‘...`);
            // Promise ê°ì²´ë¥¼ ìƒì„±í•˜ì—¬ ì¦‰ì‹œ ë°˜í™˜í•©ë‹ˆë‹¤.
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    if (shouldSucceed) {
                        log(`âœ… '${taskName}' ì‘ì—… ì„±ê³µ!`);
                        resolve(`${taskName}ì˜ ê²°ê³¼ë¬¼`); // ì„±ê³µ ì‹œ resolve í˜¸ì¶œ
                    } else {
                        log(`âŒ '${taskName}' ì‘ì—… ì‹¤íŒ¨!`);
                        reject(new Error(`'${taskName}'ì—ì„œ ì—ëŸ¬ ë°œìƒ`)); // ì‹¤íŒ¨ ì‹œ reject í˜¸ì¶œ
                    }
                }, duration);
            });
        }

        // ì„±ê³µ ì‹œë‚˜ë¦¬ì˜¤ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        successBtn.addEventListener('click', () => {
            logDiv.innerHTML = '';
            
            asyncTask('ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°', 1000, true)
                .then(result1 => {
                    // ì²« ë²ˆì§¸ ì‘ì—…ì´ ì„±ê³µí•˜ë©´ ê·¸ ê²°ê³¼(result1)ë¥¼ ë°›ê³ , ë‹¤ìŒ Promiseë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
                    console.log('1ì°¨ ê²°ê³¼:', result1);
                    return asyncTask('ê²Œì‹œë¬¼ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°', 1000, true);
                })
                .then(result2 => {
                    // ë‘ ë²ˆì§¸ ì‘ì—…ì´ ì„±ê³µí•˜ë©´ ê·¸ ê²°ê³¼(result2)ë¥¼ ë°›ìŠµë‹ˆë‹¤.
                    console.log('2ì°¨ ê²°ê³¼:', result2);
                    return asyncTask('ëŒ“ê¸€ ì •ë³´ ê°€ì ¸ì˜¤ê¸°', 1000, true);
                })
                .then(result3 => {
                    console.log('3ì°¨ ê²°ê³¼:', result3);
                    log('ğŸ‰ ëª¨ë“  ì‘ì—…ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                })
                .catch(error => {
                    // ì´ ì²´ì¸ì—ì„œ ì—ëŸ¬ëŠ” ë°œìƒí•˜ì§€ ì•Šì§€ë§Œ, ë§Œì•½ì„ ìœ„í•œ ì—ëŸ¬ í•¸ë“¤ëŸ¬ì…ë‹ˆë‹¤.
                    log(`ì—ëŸ¬ ë°œìƒ: ${error.message}`, true);
                });
        });

        // ì‹¤íŒ¨ ì‹œë‚˜ë¦¬ì˜¤ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        failBtn.addEventListener('click', () => {
            logDiv.innerHTML = '';

            asyncTask('ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°', 1000, true)
                .then(() => asyncTask('ê²Œì‹œë¬¼ ëª©ë¡ ê°€ì ¸ì˜¤ê¸° (ì‹¤íŒ¨ ì˜ˆì •)', 1000, false)) // ì—¬ê¸°ì„œ ì‹¤íŒ¨ ë°œìƒ
                .then(() => asyncTask('ëŒ“ê¸€ ì •ë³´ ê°€ì ¸ì˜¤ê¸°', 1000, true)) // ì´ ì½”ë“œëŠ” ì‹¤í–‰ë˜ì§€ ì•ŠìŒ
                .catch(error => {
                    // ì²´ì¸ ì¤‘ê°„ì— ì‹¤íŒ¨(reject)ê°€ ë°œìƒí•˜ë©´, ì´í›„ì˜ .thenì€ ê±´ë„ˆë›°ê³ 
                    // ê°€ì¥ ê°€ê¹Œìš´ .catch ë¸”ë¡ì´ ì‹¤í–‰ë©ë‹ˆë‹¤.
                    log(`â—ï¸ ìµœì¢… ì—ëŸ¬ ì²˜ë¦¬: ${error.message}`, true);
                });
        });
    </script>
</body>
</html>